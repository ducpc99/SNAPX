# config/base.yaml
# Khung mặc định cho mọi run, sẽ được override bởi các file khác.

task: next_activity

paths:
  output_dir: outputs

dataset:
  # Mặc định: S-NAP gốc, sẽ override bởi data_it.yaml khi cần
  path: datasets/S-NAP.csv
  split_file: datasets/snap_train_val_test.pkl
  case_id_col: model_id
  prefix_col: prefix
  label_col: next
  prefix_sep: ";"

data:
  drop_end: true
  invert_labels: false
  min_activities: 2
  load_limit: null   # override ở local_eval.yaml / colab.yaml nếu muốn giới hạn

sequence:
  alpha: 0.5
  markov_order: 2
  min_count: 1

graph:
  enabled: true
  dfg:
    min_count: 1
    min_ratio: 0.0
  reasoner:
    hard_mask: false
    boost_factor: 0.5
    min_prob_keep: 0.0

semantics:
  # Mặc định: tắt LLM, các mode sẽ override
  use_llm: false
  model_name: TinyLlama/TinyLlama-1.1B-Chat-v1.0
  load_in_4bit: true
  max_seq_len: 128
  mode: logprob
  gen:
    max_new_tokens: 32
    temperature: 0.0
    top_p: 1.0
    do_sample: false

  # IT few-shot (InstructionMemory)
  use_it_fewshot: false
  it_num_shots: 3
  it_memory:
    enabled: false
    dataset_path: datasets/S-NAP_instructions.csv
    limit: null
    max_examples: 200000
    min_prefix_len: 1

semantics_prior:
  enabled: false
  mode: pair           # chúng ta build pair prior từ IT
  default_weight: 1.0
  lambda_mix: 0.2
  floor: 0.7
  ceil: 1.3
  prior_map_path: datasets/sem_prior_pairs.json

guard:
  enabled: false
  mode: soft
  use_activity_guard: true
  use_trace_guard: false
  penalty_factor: 0.5
  min_prefix_len: 1
  activity_dataset: null
  trace_dataset: null

hybrid:
  top_k: 5
  enable_graph_reasoner: true
  enable_semantics_prior: false
  enable_guard: false
  enable_explanation: false

eval:
  num_samples: 2000   # override ở local_eval.yaml / colab.yaml nếu muốn
  ndcg_k: 5
  measure_cost: true
